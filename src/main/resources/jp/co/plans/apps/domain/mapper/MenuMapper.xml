<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.co.plans.apps.domain.mapper.MenuMapper">

	<!-- メニュー情報を取得する。 -->
	<select id="search" resultType="jp.co.plans.apps.domain.model.Menu">
		SELECT
			menuId,
			name,
			jp_name,
			path
		FROM
			menu
		WHERE
			available_flg = 0
			<if test="authorityList != null">
			AND authority IN
				  <foreach item="authorityList" index="auth" collection="list"
      open="(" separator="," close=")">
					#{auth}
				</foreach>
			</if>
			<if test="authorityList == null">
			<!-- 一般ユーザーメニュを表示させる。 -->
			AND authority = "000"
			</if>
	</select>

	<!-- メニュー情報を登録する。 -->
	<insert id="insert">
	 	INSERT INTO menu
		VALUES (
			#{menuId},
			#{name},
			#{jpName},
			#{path},
			#{availableFlg},
			#{authority},
			'SERVER',
			now(),
			'SERVER',
			now()
			);
	</insert>
	<!-- メニューを削除する。 -->
	<delete id="delete">
		DELETE FROM menu
		WHERE
			menu_id = #{menuId}
			AND name = #{name}
			AND jp_name = #{jpName}
			AND path = #{path}
			AND authority = #{authority}
			;
	</delete>
</mapper>